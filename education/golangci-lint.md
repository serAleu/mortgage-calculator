golangci-lint (Линтер)

* Линтер - это инструмент обеспечения качества кода, единообразия и предотвращения багов на самом раннем этапе.
* golangci-lint — это CLI утилита-линтер, которая включает не один линтер, а множесство статических анализаторов кода для Go которые можно настраивать под свой проект (по сути аналог Sonar)
* В боевом процессе всегда интегрируется с ci/cd (like Sonar) + запихивай в Makefile

Зачем нужен:
1. Единообразие кода (Code Style)
    Например:
      stylecheck: проверяет единообразие именования, оформления комментариев и т.д.
2. Поиск потенциальных багов (Bug Detection)
    Например:
      SA5011: возможное разыменование nil-указателя
      S1030: неиспользование fmt.Errorf для оборачивания ошибок
      G114: использование http.ListenAndServe без таймаутов
3. Обнаружение уязвимостей (Security)
    Например:
      G101: нахождение в коде потенциальных hardcoded паролей и токенов
      G201, G202: SQL-инъекции через неправильное использование строковых операций
4. Измерение сложности (Code Metrics)
    Например:
      gocyclo: измеряет цикломатическую сложность функций. Не даст создать функц на 1000 строк с 50ю уровнями вложенности
      funlen: проверяет длину функций и количество строк
5. Оптимизация производительности (Performance)
    Например:
      prealloc: предл предв аллоцировать слайсы, если их размер известен, чтобы избежать многократных копирований в памяти
      hugeParam: предупреждает о передаче больших структур по значению (что ведет к копированию), советуя использовать указатели.

Архитектура под капотом:

1. Парсинг: golangci-lint парсит исходный код в AST (Abstract Syntax Tree). Это позволяет анализировать структуру кода, а не просто текст.
2. Запуск линтеров: Для каждого файла он прогоняет полученное AST через все включенные линтеры.
3. Анализ и фильтрация: Каждый линтер возвращает свои предупреждения и ошибки. golangci-lint применяет к ним правила из конфига (игнорировать ли определенные типы ошибок, считать ли предупреждения ошибками и т.д.).
4. Вывод результата: Агрегированный результат выводится в консоль в удобном формате.

Использование:

0. 'go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest'
1. 'golangci-lint --version'
2. 'golangci-lint run' - запустить все линтеры для всех файлов в текущем модуле
3. 'golangci-lint run --issues-exit-code=0' - запустить с выводом только ошибок (без предупреждений)
4. 'golangci-lint run internal/calculator/calculator.go' - запустить для конкретного файла
5. 'golangci-lint run -v' - запустить с выводом статистики по времени работы каждого линтера
6. 'golangci-lint run --fix' - авто-исправление тех проблем, которые можно исправить автоматически
7. 'golangci-lint help linters' - посмотреть полный список линтеров
7. НЕПОСРЕДСТВЕННО в коде:
  '//nolint' — отключить линтер для следующей строки
  '//nolint:gocyclo' — отключить конкретный линтер (gocyclo) для следующей строки
  '//nolint:gocyclo,funlen' — отключить несколько линтеров
  Например:
    func veryComplexFunction() { //nolint:gocyclo,funlen
      // ... очень сложный код, который линтер будет ругать
    }

Детальный разбор конфигурации (.golangci.yml):

run:
  concurrency: 4           # Количество CPU для параллельного запуска линтеров
  timeout: 1m              # Максимальное время выполнения
  tests: false             # Не анализировать тестовые файлы (*_test.go)
  issues-exit-code: 0      # Код выхода, даже если есть ошибки (0 - НЕ failing)
  go: '1.21'               # Версия Go для анализа

output:
  format: colored-line-number # Красивый вывод с номерами строк и подсветкой

issues:
  max-issues-per-linter: 1000 # Макс. количество ошибок на один линтер
  max-same-issues: 1000       # Макс. количество одинаковых ошибок

linters-settings:          # НАСТРОЙКИ КОНКРЕТНЫХ ЛИНТЕРОВ
  prealloc:
    for-loops: true        # Для prealloc: проверять только for-loop'ы

  stylecheck:
    go: "1.21"             # Версия Go для stylecheck
    checks: ["all"]        # Включить все проверки stylecheck

  staticcheck:
    go: "1.21"
    checks: ["all"]        # Мощнейший линтер, включает сотни проверок

  gocritic:                # Очень умный линтер с "советами" по улучшению кода
    disabled-checks:
      - hugeParam          # Исключаем проверку на большие параметры (спорно)
    enabled-tags:          # Включаем категории проверок
      - diagnostic         # Диагностика
      - style              # Стиль
      - performance        # Производительность
      - experimental       # Экспериментальные
      - opinionated        # Opinionated проверки

  govet:
    check-shadowing: true  # Проверять затенение переменных
    enable-all: true       # Включить все проверки govet

linters:
  disable-all: true        # ВАЖНО: Отключаем ВСЕ линтеры по умолчанию
  enable:                  # и явно включаем только те, что нам нужны
    - bodyclose            # Проверяет, закрываются ли response.Body в HTTP
    - dogsled              # Считает кол-во `_` в assignments (max-blank-identifiers: 2)
    - dupl                 Поиск повторяющегося кода
    - errcheck             # КРИТИЧЕСКИ ВАЖНЫЙ: проверяет, что ошибки не игнорируются
    - forbidigo            # Запрещает использование определенных идентификаторов
    - funlen               # Длина функций
    - gochecknoinits       # Запрещает функцию init()
    - goconst              # Ищет магические числа/строки, предлагает вынести в константы
    - gocritic             # Включает gocritic с настройками выше
    - gocyclo              # Измеряет сложность функций (cyclomatic complexity)
    - gofmt                # Проверяет форматирование
    - gomodguard           # Контроль за зависимостями (может запрещать некоторые модули)
    - revive               # Более современная замена golint
    - gosec                # Сканер безопасности (Security)
    - gosimple             # Ищет код, который можно упростить
    - govet                # Официальный линтер Go (must have)
    - godot                # Проверяет комментарии (точки в конце и т.д.)
    - ineffassign          # Находит неэффективные присваивания (переменная назначена but not used)
    - misspell             # Поиск опечаток в строках и комментариях
    - nakedret             # Запрещает "голый" return в named return функциях
    - nolintlint           # Следит за правильностью использования директив `//nolint`
    - exportloopref        # Находит опасные ссылки на переменные цикла
    - prealloc             # Советует preallocate slices
    - staticcheck          # Включает staticcheck с настройками выше
    - stylecheck           # Включает stylecheck с настройками выше
    - typecheck            # Проверка типов (как компилятор)
    - unconvert            # Находит ненужные конвертации типов
    - unparam              # Находит неиспользуемые параметры функций
    - unused               # Находит неиспользуемый код (переменные, функции, константы)
    - whitespace           # Ищет лишние пробелы

ПРИМ: на issues-exit-code походу ci завязывается, 1 = блокирующий режим
ПРИМ: можно замутить свой линтер через кастомную конфигурацию 'revive' и TOML DSL 
